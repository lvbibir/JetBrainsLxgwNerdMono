<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JetBrainsLxgwNerdMono (Split) 2:1 Ratio Verification</title>
    <!-- Split CSS will be loaded dynamically -->
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #1e1e1e;
            color: #d4d4d4;
        }

        .controls {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #2d2d2d;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            z-index: 1000;
        }

        .controls label {
            margin-right: 20px;
            font-size: 14px;
        }

        .controls select {
            background-color: #3c3c3c;
            color: #d4d4d4;
            border: 1px solid #555;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
        }

        .controls select:hover {
            background-color: #4c4c4c;
        }

        .container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding-top: 15vh;
        }

        .content {
            font-family: 'JetBrainsLxgwNerdMono', monospace;
            font-size: 3vw;
            line-height: 1.8;
            white-space: pre;
            letter-spacing: 0;
            transition: all 0.3s ease;
            font-weight: 400;
            font-style: normal;
        }

        .separator {
            color: #666;
        }

        .loading {
            text-align: center;
            padding: 20px;
            font-size: 16px;
            color: #888;
        }

        .error {
            color: #f44;
        }
    </style>
</head>
<body>
    <div class="controls">
        <label for="weight-select">字重 / Weight:</label>
        <select id="weight-select">
            <option value="">Loading...</option>
        </select>
    </div>

    <div class="container">
        <div class="content" id="display-text">----------------中英文2:1---------------
|ab|cd|ef|gh|ij|kl|mn|op|qr|st|uv|wx|yz|
|这|应|该|是|中|英|文|完|美|的|2:|1等距|
|A0|1!|2@|3#|4$|5%|6^|7&|8*|9(|0)|=+|[]|
|󰈹|󰊕||󰀘|󰊤|󰍉|󰏔|󰖟|󰚩|󰌠|󰃻|󰜴|󰒍|</div>
    </div>

    <script>
        const MANIFEST_PATH = 'output/fonts/fonts-manifest.json';
        const SPLIT_CSS_PATH = 'output/split/all.css';

        const weightSelect = document.getElementById('weight-select');
        const displayText = document.getElementById('display-text');

        // Store loaded font info
        let loadedFonts = null;

        // Weight mapping: style -> { weight, style }
        const WEIGHT_MAP = {
            'Regular': { weight: 400, style: 'normal' },
            'Medium': { weight: 500, style: 'normal' },
            'Italic': { weight: 400, style: 'italic' },
            'MediumItalic': { weight: 500, style: 'italic' },
            'Bold': { weight: 700, style: 'normal' },
            'BoldItalic': { weight: 700, style: 'italic' },
            'Light': { weight: 300, style: 'normal' },
            'LightItalic': { weight: 300, style: 'italic' }
        };

        // Load split CSS
        function loadSplitCSS() {
            return new Promise((resolve, reject) => {
                const link = document.createElement('link');
                link.rel = 'stylesheet';
                link.href = SPLIT_CSS_PATH;
                link.onload = resolve;
                link.onerror = () => reject(new Error('Failed to load split CSS'));
                document.head.appendChild(link);
            });
        }

        // Populate select dropdown
        function populateSelect(fonts) {
            weightSelect.innerHTML = '';

            fonts.forEach((font, index) => {
                const option = document.createElement('option');
                option.value = font.style;
                option.textContent = font.display_name;
                if (index === 0) option.selected = true;
                weightSelect.appendChild(option);
            });

            // Apply first font
            if (fonts.length > 0) {
                applyFont(fonts[0].style);
            }
        }

        // Apply selected font weight and style
        function applyFont(style) {
            const mapping = WEIGHT_MAP[style] || { weight: 400, style: 'normal' };
            displayText.style.fontWeight = mapping.weight;
            displayText.style.fontStyle = mapping.style;
        }

        // Load manifest and initialize
        async function init() {
            try {
                // Try to load split CSS first
                await loadSplitCSS();

                // Load manifest
                const response = await fetch(MANIFEST_PATH);
                if (!response.ok) {
                    throw new Error(`Failed to load manifest: ${response.status}`);
                }

                const manifest = await response.json();
                loadedFonts = manifest;

                // Populate dropdown
                populateSelect(manifest.fonts);

                // Update page title and font family
                document.title = `${manifest.family_name} (Split) 2:1 Ratio Verification`;
                displayText.style.fontFamily = `'${manifest.family_name}', monospace`;

            } catch (error) {
                console.error('Error loading fonts:', error);

                // Fallback mode
                fallbackMode();
            }
        }

        // Fallback mode when manifest is not available
        function fallbackMode() {
            const defaultFonts = [
                { style: 'Regular', display_name: 'Regular' },
                { style: 'Medium', display_name: 'Medium' },
                { style: 'Italic', display_name: 'Italic' },
                { style: 'MediumItalic', display_name: 'Medium Italic' }
            ];

            loadedFonts = { family_name: 'JetBrainsLxgwNerdMono', fonts: defaultFonts };
            populateSelect(defaultFonts);
        }

        // Event listener for weight change
        weightSelect.addEventListener('change', function() {
            applyFont(this.value);
        });

        // Initialize on page load
        init();
    </script>
</body>
</html>
