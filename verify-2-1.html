<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JetBrainsLxgwNerdMono 2:1 Ratio Verification</title>
    <style>
        /* Font faces will be dynamically generated */
        body {
            margin: 0;
            padding: 0;
            background-color: #1e1e1e;
            color: #d4d4d4;
        }

        .controls {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #2d2d2d;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            z-index: 1000;
        }

        .controls label {
            margin-right: 20px;
            font-size: 14px;
        }

        .controls select {
            background-color: #3c3c3c;
            color: #d4d4d4;
            border: 1px solid #555;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
        }

        .controls select:hover {
            background-color: #4c4c4c;
        }

        .container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding-top: 15vh;
        }

        .content {
            font-family: monospace;
            font-size: 3vw;
            line-height: 1.8;
            white-space: pre;
            letter-spacing: 0;
            transition: font-family 0.3s ease;
        }

        .separator {
            color: #666;
        }

        .loading {
            text-align: center;
            padding: 20px;
            font-size: 16px;
            color: #888;
        }

        .error {
            color: #f44;
        }
    </style>
</head>
<body>
    <div class="controls">
        <label for="weight-select">字重 / Weight:</label>
        <select id="weight-select">
            <option value="">Loading...</option>
        </select>
    </div>

    <div class="container">
        <div class="content" id="display-text">----------------中英文2:1---------------
|ab|cd|ef|gh|ij|kl|mn|op|qr|st|uv|wx|yz|
|这|应|该|是|中|英|文|完|美|的|2:|1等距|
|A0|1!|2@|3#|4$|5%|6^|7&|8*|9(|0)|=+|[]|
|󰈹|󰊕||󰀘|󰊤|󰍉|󰏔|󰖟|󰚩|󰌠|󰃻|󰜴|󰒍|</div>
    </div>

    <script>
        const MANIFEST_PATH = 'output/fonts/fonts-manifest.json';
        const FONTS_DIR = 'output/fonts/';

        const weightSelect = document.getElementById('weight-select');
        const displayText = document.getElementById('display-text');

        // Store loaded font info
        let loadedFonts = [];

        // Dynamically inject @font-face rules
        function injectFontFaces(fonts, familyName) {
            const style = document.createElement('style');
            let css = '';

            fonts.forEach(font => {
                const fontFamilyName = `${familyName}-${font.style}`;
                css += `
                    @font-face {
                        font-family: '${fontFamilyName}';
                        src: url('${FONTS_DIR}${font.filename}') format('truetype');
                    }
                `;
            });

            style.textContent = css;
            document.head.appendChild(style);
        }

        // Populate select dropdown
        function populateSelect(fonts) {
            weightSelect.innerHTML = '';

            fonts.forEach((font, index) => {
                const option = document.createElement('option');
                option.value = font.style;
                option.textContent = font.display_name;
                if (index === 0) option.selected = true;
                weightSelect.appendChild(option);
            });

            // Apply first font
            if (fonts.length > 0) {
                applyFont(fonts[0].style);
            }
        }

        // Apply selected font
        function applyFont(style) {
            const manifest = loadedFonts;
            if (manifest && manifest.family_name) {
                displayText.style.fontFamily = `'${manifest.family_name}-${style}', monospace`;
            }
        }

        // Load manifest and initialize
        async function init() {
            try {
                const response = await fetch(MANIFEST_PATH);
                if (!response.ok) {
                    throw new Error(`Failed to load manifest: ${response.status}`);
                }

                const manifest = await response.json();
                loadedFonts = manifest;

                // Inject font faces
                injectFontFaces(manifest.fonts, manifest.family_name);

                // Populate dropdown
                populateSelect(manifest.fonts);

                // Update page title
                document.title = `${manifest.family_name} 2:1 Ratio Verification`;

            } catch (error) {
                console.error('Error loading fonts:', error);
                weightSelect.innerHTML = '<option value="" class="error">Error loading fonts</option>';

                // Fallback: try to detect fonts from common patterns
                fallbackMode();
            }
        }

        // Fallback mode when manifest is not available
        function fallbackMode() {
            const defaultFonts = [
                { style: 'Regular', display_name: 'Regular' },
                { style: 'Medium', display_name: 'Medium' },
                { style: 'Italic', display_name: 'Italic' },
                { style: 'MediumItalic', display_name: 'Medium Italic' }
            ];

            const familyName = 'JetBrainsLxgwNerdMono';
            loadedFonts = { family_name: familyName, fonts: defaultFonts };

            injectFontFaces(defaultFonts.map(f => ({
                ...f,
                filename: `${familyName}-${f.style}.ttf`
            })), familyName);

            populateSelect(defaultFonts);
        }

        // Event listener for weight change
        weightSelect.addEventListener('change', function() {
            applyFont(this.value);
        });

        // Initialize on page load
        init();
    </script>
</body>
</html>
